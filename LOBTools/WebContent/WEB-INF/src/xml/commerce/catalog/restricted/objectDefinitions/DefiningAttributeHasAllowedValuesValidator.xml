<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of IBM

  WebSphere Commerce

  (C) Copyright IBM Corp. 2015 All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or
  disclosure restricted by GSA ADP Schedule Contract with
  IBM Corp.
 =================================================================
-->

<Definitions>

	<!---
	    This is a custom validator that will warn the user that allowed values must be added to the defining
		attribute for values to be managed at the Product SKU level.  

		The code for the validator is not customizable.
	-->
	<Validator classDefinition="true" definitionName="cmc/catalog/CatalogEntryDefiningAttributeHasAllowedValuesValidator">
		<dependency localName="catalogResources" moduleName="cmc/catalog/CatalogResources"/>
		<dependency localName="Logger" moduleName="cmc/shell/Logger"/>
	
		<!--- 
			The error message associated with the validation error generated by this validator
		 -->
		<variable name="errorMessage" type="string" value="${catalogResources.Singleton.definingAttributeNoAllowedValuesProductWarning.string}"/>	
				
		<!--- 
		    This is a custom validator that will warn the user that allowed values must be added to the defining
			attribute for values to be managed at the Product SKU level.  
	
			The code for the validator is not customizable.
        	
			@param cmc/foundation/ModelObject o the model object that is to be validated.
		-->
		<method args="o, property" name="validate">
			<![CDATA[
			if (typeof(property) == "undefined") property = null;
			if (Logger.Singleton.enabled) {
				Logger.Singleton.entering("com.ibm.commerce.lobtools.catalog", "cmc/catalog/CatalogEntryDefiningAttributeHasAllowedValuesValidator", "validate");
			}
			if (!o) {
				return;
			}
			if (Logger.Singleton.enabled) {
				Logger.Singleton.log("com.ibm.commerce.lobtools.catalog", "INFO", "cmc/catalog/CatalogEntryDefiningAttributeHasAllowedValuesValidator", "validate", "o=" + o.logString() + ".");
			}
			var definingAttributeDataType = o.getPropertyValue("attrDataType");
			if (Logger.Singleton.enabled) {
				Logger.Singleton.log("com.ibm.commerce.lobtools.catalog", "INFO", "cmc/catalog/CatalogEntryDefiningAttributeHasAllowedValuesValidator", "validate", "definingAttributeDataType=" + definingAttributeDataType + ".");
			}
			var definingAttributeAllowedValues = [];
			if (definingAttributeDataType == "String") {
				definingAttributeAllowedValues = o.getObjects("CatalogEntryStringDefiningAttributeAllowedValue");
			}
			if (definingAttributeDataType == "Integer") {
				definingAttributeAllowedValues = o.getObjects("CatalogEntryIntegerDefiningAttributeAllowedValue");
			}
			if (definingAttributeDataType == "Float") {
				definingAttributeAllowedValues = o.getObjects("CatalogEntryFloatDefiningAttributeAllowedValue");
			}
			if (definingAttributeAllowedValues.length == 0) {
				o.addValidationError(this, this.errorMessage);
			}
			else {
				o.clearValidationError(this);
			}
			if (Logger.Singleton.enabled) {
				Logger.Singleton.exiting("com.ibm.commerce.lobtools.catalog", "cmc/catalog/CatalogEntryDefiningAttributeHasAllowedValuesValidator", "validate");
			}
			]]>
		</method>
	</Validator>
</Definitions>