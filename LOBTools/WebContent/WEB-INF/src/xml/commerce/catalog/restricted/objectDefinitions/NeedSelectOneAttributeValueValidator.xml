<?xml version="1.0" encoding="UTF-8"?>
<!--
 =================================================================
  Licensed Materials - Property of IBM

  WebSphere Commerce

  (C) Copyright IBM Corp. 2015 All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or
  disclosure restricted by GSA ADP Schedule Contract with
  IBM Corp.
 =================================================================
-->
<Definitions>

	<!---  
		This validator checks that the value of the "attrValueValue" property is acceptable based on the current value of the "attrDataType" 
		property. A message will be added to the "attrValueValue" property if the "attrDataType" property's value is 
		"Integer" and the "attrValueValue" property's value does not match boundary.
		@keywords deprecated
	 -->
  <Validator classDefinition="true" definitionName="cmc/catalog/NeedSelectOneAttributeValueValidator">
		<dependency localName="catalogResources" moduleName="cmc/catalog/CatalogResources"/>
		<dependency localName="Logger" moduleName="cmc/shell/Logger"/>
	
		<!--- 
			The error message associated with the validation error generated by this validator
		 -->
		<variable name="errorMessage" type="string" value="${catalogResources.Singleton.needSelectOneAttributeValue.string}"/>	
								
		<!--- 
		    This is a custom validator that will warn the user that allowed values must be added to the defining
			attribute for values to be managed at the Variant level.  
	
			The code for the validator is not customizable.
        	
			@param cmc/foundation/ModelObject o the model object that is to be validated.
		-->
		<method args="o, property" name="validate">
			<![CDATA[
			if (typeof(property) == "undefined") property = null;
			if (Logger.Singleton.enabled) {
				Logger.Singleton.entering("com.ibm.commerce.lobtools.catalog", "cmc/catalog/VariantHasAtLeastOneDefiningAttributeValueValidator", "validate");
			}
			if (!o) {
				return;
			}
			if (Logger.Singleton.enabled) {
				Logger.Singleton.log("com.ibm.commerce.lobtools.catalog", "INFO", "cmc/catalog/VariantHasAtLeastOneDefiningAttributeValueValidator", "validate", "o=" + o.logString() + ".");
			}

			var adValueSelected = 0;
			var vrtRefAttrVal=o.getObjects("VariantReferenceDefiningAttributeDictionaryAttributeWithAllowedValues");
			vrtRefAttrVal = vrtRefAttrVal.concat(o.getObjects("VariantReferenceDefiningInheritedAttributeDictionaryAttributeWithAllowedValues"));
            for (var i = 0; i < vrtRefAttrVal.length; i++) {
					var attrValue = vrtRefAttrVal[i].getPropertyValue("attrValId");
					if(attrValue && attrValue != ""){
					  adValueSelected++;
					}
			}
			
			if (adValueSelected == 0) {
				o.addValidationError(this, this.errorMessage);
			}else {
				o.clearValidationError(this);
			}
			if (Logger.Singleton.enabled) {
				Logger.Singleton.exiting("com.ibm.commerce.lobtools.catalog", "cmc/catalog/VariantHasAtLeastOneDefiningAttributeValueValidator", "validate");
			}
			]]>
		</method>
	</Validator>
	
</Definitions>