CKEDITOR.plugins.add("ibmbidi",{init:function(b){var c="",e;for(e in CKEDITOR.dtd.$block)c+=e+" ";b.config.extraAllowedContent[c]={propertiesOnly:!0,attributes:"dir"};b.on("key",function(a){switch(a.data.keyCode){case CKEDITOR.CTRL+CKEDITOR.SHIFT+88:a.cancel()}},b);b.config.blockedKeystrokes.push(CKEDITOR.SHIFT+CKEDITOR.ALT+36);b.config.blockedKeystrokes.push(CKEDITOR.SHIFT+CKEDITOR.ALT+35);b.setKeystroke(CKEDITOR.SHIFT+CKEDITOR.ALT+36,"bidiltr");b.setKeystroke(CKEDITOR.SHIFT+CKEDITOR.ALT+35,"bidirtl")},
afterInit:function(b){var c=b.config.contentsLangDirection,e=b.config.toolbar;"string"==typeof e&&(e=b.config["toolbar_"+e]);if(e)for(var a,d,g,h,i,j,k,l,m=0;m<e.length;m++){g=h=i=j=k=l=-1;a=e[m];a=a.items||a;for(var f=0;f<a.length;f++)d=a[f],"JustifyLeft"==d?g=f:"JustifyCenter"==d?h=f:"JustifyRight"==d?i=f:"JustifyBlock"==d?j=f:"BidiLtr"==d?k=f:"BidiRtl"==d&&(l=f);if(-1!=k&&-1!=l&&("rtl"==c&&k<l||"ltr"==c&&k>l))d=a[k],a[k]=a[l],a[l]=d;if(-1!=g&&-1!=h&&-1!=i&&-1!=j){if("rtl"==c&&g<j||"ltr"==c&&g>
j)d=a[g],a[g]=a[j],a[j]=d;if("rtl"==c&&h<i||"ltr"==c&&h>i)d=a[h],a[h]=a[i],a[i]=d}}"ui"==c&&(c=b.lang.dir);b.dataProcessor.htmlFilter.addRules({elements:{$:function(a){if(!a.parent.parent&&CKEDITOR.dtd.$block[a.name]){var b=a.attributes;a:{do if(a.attributes&&a.attributes.dir){a=a.attributes.dir;break a}while(a=a.parent);a=c}b.dir=a}}}})}});