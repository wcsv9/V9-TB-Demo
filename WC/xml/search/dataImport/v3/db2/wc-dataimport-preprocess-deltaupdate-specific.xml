<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of IBM

  WebSphere Commerce

  (C) Copyright IBM Corp. 2016. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or
  disclosure restricted by GSA ADP Schedule Contract with
  IBM Corp.
 =================================================================
-->
<_config:DIHPreProcessConfig xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../xsd/wc-dataimport-preprocess.xsd">
	
	<_config:data-processing-config processor="com.ibm.commerce.foundation.dataimport.preprocess.StaticAttributeDataPreProcessor" batchSize="500" >
		<_config:table definition="CREATE TABLE TI_D_CATENTRY_#INDEX_SCOPE_TAG# (CATENTRY_ID BIGINT NOT NULL, ACTION CHAR(1), PRIMARY KEY (CATENTRY_ID))" name="TI_D_CATENTRY_#INDEX_SCOPE_TAG#"/>
		<_config:query sql="SELECT CATENTRY_ID, ACTION FROM TI_DELTA_CATENTRY CE WHERE CE.ACTION='DA' AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID#
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION FROM CATENTREL CR, TI_DELTA_CATENTRY CE1
				WHERE CE1.ACTION = 'D'
				AND CE1.CATENTRY_ID = CR.CATENTRY_ID_CHILD
				AND CR.CATENTRY_ID_PARENT IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION FROM CATENTREL CR,  TI_DELTA_CATENTRY CE1
				WHERE CE1.ACTION = 'D' 
				AND CE1.CATENTRY_ID = CR.CATENTRY_ID_CHILD  
				AND	CR.CATENTRY_ID_PARENT IN (SELECT CCR.CATENTRY_ID_PARENT FROM TI_DELTA_CATENTRY CE, CATENTREL CCR WHERE CCR.CATENTRY_ID_CHILD= CE.CATENTRY_ID AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION FROM CATENTREL CR, TI_DELTA_CATENTRY CE1
				WHERE CE1.ACTION = 'D'
				AND CE1.CATENTRY_ID = CR.CATENTRY_ID_PARENT
				AND CR.CATENTRY_ID_CHILD IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION
				FROM DKPDCCATENTREL DKCR, TI_DELTA_CATENTRY CE1, DKPDCCOMPLIST
				WHERE CE1.ACTION = 'D'
				AND CE1.CATENTRY_ID = DKPDCCOMPLIST.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID = DKCR.DKPREDEFCONF_ID
				AND DKCR.SEQUENCE=0
				AND DKCR.CATENTRY_ID IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION
				FROM DKPDCCATENTREL DKCR, TI_DELTA_CATENTRY CE1, DKPDCCOMPLIST
				WHERE CE1.ACTION = 'D'
				AND CE1.CATENTRY_ID = DKPDCCOMPLIST.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID = DKCR.DKPREDEFCONF_ID
				AND DKCR.CATENTRY_ID IN
				(SELECT DKREL.CATENTRY_ID
				FROM TI_DELTA_CATENTRY CE, DKPDCCATENTREL DKREL, DKPDCCOMPLIST DKLIST
				WHERE DKLIST.CATENTRY_ID = CE.CATENTRY_ID
				AND DKLIST.DKPREDEFCONF_ID=DKREL.DKPREDEFCONF_ID
				AND DKREL.SEQUENCE=0 AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'
				))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION
				FROM DKPDCCATENTREL DKCR, TI_DELTA_CATENTRY CE1, DKPDCCOMPLIST
				WHERE CE1.ACTION = 'D'
				AND CE1.CATENTRY_ID=DKCR.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID=DKCR.DKPREDEFCONF_ID
				AND DKCR.SEQUENCE=0
				AND DKPDCCOMPLIST.CATENTRY_ID IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))"/>
		<_config:mapping>
		  <_config:key queryColumn="CATENTRY_ID" tableColumn="CATENTRY_ID"/>
		  <_config:column-mapping>
			<_config:column-column-mapping>
				<_config:column-column queryColumn="ACTION" tableColumn="ACTION" />
			</_config:column-column-mapping>
			</_config:column-mapping>
		</_config:mapping>
	</_config:data-processing-config>
  
	<_config:data-processing-config processor="com.ibm.commerce.foundation.dataimport.preprocess.StaticAttributeDataPreProcessor"  batchSize="500">
		<_config:table definition="CREATE TABLE TI_CATENTRY_#INDEX_SCOPE_TAG# (CATENTRY_ID BIGINT NOT NULL, CATENTTYPE_ID CHAR(16), PRIMARY KEY (CATENTRY_ID))" name="TI_CATENTRY_#INDEX_SCOPE_TAG#" />
		<_config:query sql="(SELECT CE.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID FROM CATENTRY C, TI_DELTA_CATENTRY CE
				WHERE CE.CATENTRY_ID=C.CATENTRY_ID AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A')
				UNION
				(SELECT C.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID FROM CATENTRY C, CATENTREL CR
				WHERE C.MARKFORDELETE = 0
				AND C.CATENTRY_ID = CR.CATENTRY_ID_CHILD
				AND CR.CATENTRY_ID_PARENT IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT C.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID FROM CATENTRY C, CATENTREL CR
				WHERE C.MARKFORDELETE = 0 
				AND C.CATENTRY_ID = CR.CATENTRY_ID_CHILD  
				AND	CR.CATENTRY_ID_PARENT IN (SELECT CCR.CATENTRY_ID_PARENT FROM TI_DELTA_CATENTRY CE, CATENTREL CCR WHERE CCR.CATENTRY_ID_CHILD= CE.CATENTRY_ID AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT C.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID FROM CATENTRY C, CATENTREL CR
				WHERE C.MARKFORDELETE = 0
				AND C.CATENTRY_ID = CR.CATENTRY_ID_PARENT
				AND CR.CATENTRY_ID_CHILD IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT DKPDCCOMPLIST.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID
				FROM DKPDCCATENTREL DKCR, CATENTRY C, DKPDCCOMPLIST
				WHERE C.MARKFORDELETE = 0
				AND C.CATENTRY_ID = DKPDCCOMPLIST.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID = DKCR.DKPREDEFCONF_ID
				AND DKCR.SEQUENCE=0
				AND DKCR.CATENTRY_ID IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT DKPDCCOMPLIST.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID
				FROM DKPDCCATENTREL DKCR, CATENTRY C, DKPDCCOMPLIST
				WHERE C.MARKFORDELETE = 0
				AND C.CATENTRY_ID = DKPDCCOMPLIST.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID = DKCR.DKPREDEFCONF_ID
				AND DKCR.CATENTRY_ID IN
				(SELECT DKREL.CATENTRY_ID
				FROM TI_DELTA_CATENTRY CE, DKPDCCATENTREL DKREL, DKPDCCOMPLIST DKLIST
				WHERE DKLIST.CATENTRY_ID = CE.CATENTRY_ID
				AND DKLIST.DKPREDEFCONF_ID=DKREL.DKPREDEFCONF_ID
				AND DKREL.SEQUENCE=0 AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'
				))
				UNION
				(SELECT DKCR.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID
				FROM DKPDCCATENTREL DKCR, CATENTRY C, DKPDCCOMPLIST
				WHERE C.MARKFORDELETE = 0
				AND C.CATENTRY_ID=DKCR.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID=DKCR.DKPREDEFCONF_ID
				AND DKCR.SEQUENCE=0
				AND DKPDCCOMPLIST.CATENTRY_ID IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT GRANDCHILD.CATENTRY_ID CATENTRY_ID, GRANDCHILD.CATENTTYPE_ID CATENTTYPE_ID FROM CATENTRY CHILD, CATENTREL CR_CHILD,CATENTRY GRANDCHILD, CATENTREL CR_GRANDCHILD
				WHERE CHILD.MARKFORDELETE = 0 AND CHILD.CATENTTYPE_ID='PredDynaKitBean' 
				AND CHILD.CATENTRY_ID = CR_CHILD.CATENTRY_ID_CHILD
				AND CR_CHILD.CATENTRY_ID_PARENT IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A')
				AND CHILD.CATENTRY_ID = CR_GRANDCHILD.CATENTRY_ID_PARENT AND CR_GRANDCHILD.CATENTRY_ID_CHILD = GRANDCHILD.CATENTRY_ID AND GRANDCHILD.MARKFORDELETE=0)
				UNION
				(SELECT SIB_CHILD.CATENTRY_ID CATENTRY_ID, SIB_CHILD.CATENTTYPE_ID CATENTTYPE_ID FROM CATENTRY SIB, CATENTREL CR_SIB, CATENTRY SIB_CHILD, CATENTREL CR_SIB_CHILD
				WHERE SIB.MARKFORDELETE = 0 AND SIB.CATENTTYPE_ID='PredDynaKitBean' 
				AND SIB.CATENTRY_ID = CR_SIB.CATENTRY_ID_CHILD  
				AND	CR_SIB.CATENTRY_ID_PARENT IN (SELECT CCR.CATENTRY_ID_PARENT FROM TI_DELTA_CATENTRY CE, CATENTREL CCR WHERE CCR.CATENTRY_ID_CHILD= CE.CATENTRY_ID AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A')
				AND SIB.CATENTRY_ID = CR_SIB_CHILD.CATENTRY_ID_PARENT AND CR_SIB_CHILD.CATENTRY_ID_CHILD = SIB_CHILD.CATENTRY_ID AND SIB_CHILD.MARKFORDELETE=0)"/>
		<_config:mapping>
		  <_config:key queryColumn="CATENTRY_ID" tableColumn="CATENTRY_ID"/>
		  <_config:column-mapping>
			<_config:column-column-mapping>
				<_config:column-column queryColumn="CATENTTYPE_ID" tableColumn="CATENTTYPE_ID" />
			</_config:column-column-mapping>
			</_config:column-mapping>
		</_config:mapping>
	</_config:data-processing-config>
  
	<_config:data-processing-config processor="com.ibm.commerce.foundation.dataimport.preprocess.StaticAttributeDataPreProcessor" batchSize="500" >
		<_config:table definition="CREATE TABLE TI_X_CATENTRY_#INDEX_SCOPE_TAG# (CATENTRY_ID BIGINT NOT NULL, ACTION CHAR(1), PRIMARY KEY (CATENTRY_ID))" name="TI_X_CATENTRY_#INDEX_SCOPE_TAG#"/>
		<_config:query sql="SELECT CATENTRY_ID, ACTION FROM TI_DELTA_CATENTRY CE WHERE CE.ACTION='XA' AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID#
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION FROM CATENTREL CR, TI_DELTA_CATENTRY CE1
				WHERE CE1.ACTION = 'X'
				AND CE1.CATENTRY_ID = CR.CATENTRY_ID_CHILD
				AND CR.CATENTRY_ID_PARENT IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION FROM CATENTREL CR,  TI_DELTA_CATENTRY CE1
				WHERE CE1.ACTION = 'X' 
				AND CE1.CATENTRY_ID = CR.CATENTRY_ID_CHILD  
				AND	CR.CATENTRY_ID_PARENT IN (SELECT CCR.CATENTRY_ID_PARENT FROM TI_DELTA_CATENTRY CE, CATENTREL CCR WHERE CCR.CATENTRY_ID_CHILD= CE.CATENTRY_ID AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION FROM CATENTREL CR, TI_DELTA_CATENTRY CE1
				WHERE CE1.ACTION = 'X'
				AND CE1.CATENTRY_ID = CR.CATENTRY_ID_PARENT
				AND CR.CATENTRY_ID_CHILD IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION
				FROM DKPDCCATENTREL DKCR, TI_DELTA_CATENTRY CE1, DKPDCCOMPLIST
				WHERE CE1.ACTION = 'X'
				AND CE1.CATENTRY_ID = DKPDCCOMPLIST.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID = DKCR.DKPREDEFCONF_ID
				AND DKCR.SEQUENCE=0
				AND DKCR.CATENTRY_ID IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION
				FROM DKPDCCATENTREL DKCR, TI_DELTA_CATENTRY CE1, DKPDCCOMPLIST
				WHERE CE1.ACTION = 'X'
				AND CE1.CATENTRY_ID = DKPDCCOMPLIST.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID = DKCR.DKPREDEFCONF_ID
				AND DKCR.CATENTRY_ID IN
				(SELECT DKREL.CATENTRY_ID
				FROM TI_DELTA_CATENTRY CE, DKPDCCATENTREL DKREL, DKPDCCOMPLIST DKLIST
				WHERE DKLIST.CATENTRY_ID = CE.CATENTRY_ID
				AND DKLIST.DKPREDEFCONF_ID=DKREL.DKPREDEFCONF_ID
				AND DKREL.SEQUENCE=0 AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'
				))
				UNION
				(SELECT CE1.CATENTRY_ID CATENTRY_ID, CE1.ACTION
				FROM DKPDCCATENTREL DKCR, TI_DELTA_CATENTRY CE1, DKPDCCOMPLIST
				WHERE CE1.ACTION = 'X'
				AND CE1.CATENTRY_ID=DKCR.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID=DKCR.DKPREDEFCONF_ID
				AND DKCR.SEQUENCE=0
				AND DKPDCCOMPLIST.CATENTRY_ID IN (SELECT CE.CATENTRY_ID FROM TI_DELTA_CATENTRY CE WHERE CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CE.ACTION='A'))"/>
		<_config:mapping>
		  <_config:key queryColumn="CATENTRY_ID" tableColumn="CATENTRY_ID"/>
		  <_config:column-mapping>
			<_config:column-column-mapping>
				<_config:column-column queryColumn="ACTION" tableColumn="ACTION" />
			</_config:column-column-mapping>
			</_config:column-mapping>
		</_config:mapping>
	</_config:data-processing-config>  
</_config:DIHPreProcessConfig>
