<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of IBM

  WebSphere Commerce

  (C) Copyright IBM Corp. 2016. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or
  disclosure restricted by GSA ADP Schedule Contract with
  IBM Corp.
 =================================================================
-->
<_config:DIHPreProcessConfig xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../xsd/wc-dataimport-preprocess.xsd">
	
	<_config:data-processing-config processor="com.ibm.commerce.foundation.dataimport.preprocess.StaticAttributeDataPreProcessor" batchSize="500" >
		<_config:table definition="CREATE TABLE TI_D_CATENTRY_#INDEX_SCOPE_TAG# (CATENTRY_ID BIGINT NOT NULL, ACTION CHAR(1), PRIMARY KEY (CATENTRY_ID))" name="TI_D_CATENTRY_#INDEX_SCOPE_TAG#"/>
		<_config:query sql="SELECT CATENTRY_ID, ACTION FROM TI_DELTA_CATENTRY CE WHERE CE.ACTION='D' AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID#"/>
		<_config:mapping>
		  <_config:key queryColumn="CATENTRY_ID" tableColumn="CATENTRY_ID"/>
		  <_config:column-mapping>
			<_config:column-column-mapping>
				<_config:column-column queryColumn="ACTION" tableColumn="ACTION" />
			</_config:column-column-mapping>
			</_config:column-mapping>
		</_config:mapping>
	</_config:data-processing-config>
  
	<_config:data-processing-config processor="com.ibm.commerce.foundation.dataimport.preprocess.StaticAttributeDataPreProcessor"  batchSize="500">
		<_config:table definition="CREATE TABLE TI_CATENTRY_#INDEX_SCOPE_TAG# (CATENTRY_ID BIGINT NOT NULL, CATENTTYPE_ID CHAR(16), PRIMARY KEY (CATENTRY_ID))" name="TI_CATENTRY_#INDEX_SCOPE_TAG#" />
		<_config:query sql="(SELECT CE.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID FROM CATENTRY C, TI_DELTA_CATENTRY CE
				WHERE C.MARKFORDELETE=0 AND CE.CATENTRY_ID=C.CATENTRY_ID AND CE.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#)
				AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID#)
				UNION
				(SELECT CR.CATENTRY_ID_CHILD CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID FROM CATENTREL CR, CATENTRY C, TI_DELTA_CATENTRY CE
				WHERE C.MARKFORDELETE=0 AND CE.CATENTRY_ID=CR.CATENTRY_ID_PARENT AND CE.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#)
				AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND C.CATENTRY_ID=CR.CATENTRY_ID_CHILD AND C.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#))
				UNION
				(SELECT CR.CATENTRY_ID_CHILD CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID FROM CATENTREL CR, CATENTRY C
				WHERE C.MARKFORDELETE=0 AND CR.CATENTRY_ID_PARENT IN ((SELECT CCR.CATENTRY_ID_PARENT FROM TI_DELTA_CATENTRY CE,  CATENTREL CCR WHERE CCR.CATENTRY_ID_CHILD= CE.CATENTRY_ID AND CE.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#) AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID#))
				 AND C.CATENTRY_ID=CR.CATENTRY_ID_CHILD AND C.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#))
				 UNION
				(SELECT  CR.CATENTRY_ID_PARENT CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID FROM TI_DELTA_CATENTRY CE,  CATENTREL CR, CATENTRY C WHERE C.MARKFORDELETE=0 AND CR.CATENTRY_ID_CHILD= CE.CATENTRY_ID AND CE.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#) AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID#
				 AND C.CATENTRY_ID=CR.CATENTRY_ID_PARENT)
				UNION
				(SELECT DKPDCCOMPLIST.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID
				FROM DKPDCCATENTREL DKCR, CATENTRY C, TI_DELTA_CATENTRY CE, DKPDCCOMPLIST
				WHERE C.MARKFORDELETE=0 AND CE.CATENTRY_ID=DKCR.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID=DKCR.DKPREDEFCONF_ID
				AND DKCR.SEQUENCE=0
				AND CE.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#)
				AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND C.CATENTRY_ID=DKPDCCOMPLIST.CATENTRY_ID)
				UNION
				(SELECT DKPDCCOMPLIST.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID
				FROM DKPDCCATENTREL DKCR, CATENTRY C, DKPDCCOMPLIST
				WHERE C.MARKFORDELETE=0 AND DKCR.CATENTRY_ID IN
				(SELECT DKREL.CATENTRY_ID
				FROM TI_DELTA_CATENTRY CE, DKPDCCATENTREL DKREL, DKPDCCOMPLIST DKLIST
				WHERE DKLIST.CATENTRY_ID = CE.CATENTRY_ID
				AND DKLIST.DKPREDEFCONF_ID=DKREL.DKPREDEFCONF_ID
				AND DKREL.SEQUENCE=0
				AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID#
				AND CE.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#)
				)
				AND C.CATENTRY_ID=DKPDCCOMPLIST.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID = DKCR.DKPREDEFCONF_ID)
				UNION
				(SELECT DKCR.CATENTRY_ID CATENTRY_ID, C.CATENTTYPE_ID CATENTTYPE_ID
				FROM DKPDCCATENTREL DKCR, CATENTRY C, TI_DELTA_CATENTRY CE, DKPDCCOMPLIST
				WHERE C.MARKFORDELETE=0 AND CE.CATENTRY_ID=DKPDCCOMPLIST.CATENTRY_ID
				AND DKPDCCOMPLIST.DKPREDEFCONF_ID=DKCR.DKPREDEFCONF_ID
				AND DKCR.SEQUENCE=0
				AND CE.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#)
				AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND C.CATENTRY_ID=DKCR.CATENTRY_ID)
				UNION
				(SELECT CR_GRANDCHILD.CATENTRY_ID_CHILD CATENTRY_ID, GRANDCHILD.CATENTTYPE_ID CATENTTYPE_ID 
				FROM CATENTREL CR_CHILD, CATENTRY CHILD, TI_DELTA_CATENTRY CE,CATENTREL CR_GRANDCHILD, CATENTRY GRANDCHILD
				WHERE CHILD.MARKFORDELETE=0 AND CHILD.CATENTTYPE_ID='PredDynaKitBean' AND CE.CATENTRY_ID=CR_CHILD.CATENTRY_ID_PARENT AND CE.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#)
				AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID# AND CHILD.CATENTRY_ID=CR_CHILD.CATENTRY_ID_CHILD AND CHILD.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#)
				AND CR_CHILD.CATENTRY_ID_CHILD=CR_GRANDCHILD.CATENTRY_ID_PARENT AND CR_GRANDCHILD.CATENTRY_ID_CHILD=GRANDCHILD.CATENTRY_ID
				AND GRANDCHILD.MARKFORDELETE=0 AND  GRANDCHILD.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#))
				UNION
				(SELECT CR_SIB_CHILD.CATENTRY_ID_CHILD CATENTRY_ID, SIB_CHILD.CATENTTYPE_ID CATENTTYPE_ID 
				FROM CATENTREL CR_SIB, CATENTRY SIB,CATENTREL CR_SIB_CHILD, CATENTRY SIB_CHILD
				WHERE SIB.MARKFORDELETE=0 AND SIB.CATENTTYPE_ID='PredDynaKitBean' AND CR_SIB.CATENTRY_ID_PARENT IN (SELECT CCR.CATENTRY_ID_PARENT FROM TI_DELTA_CATENTRY CE,  CATENTREL CCR WHERE CCR.CATENTRY_ID_CHILD= CE.CATENTRY_ID AND CE.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#) AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID#)
				 AND SIB.CATENTRY_ID=CR_SIB.CATENTRY_ID_CHILD AND SIB.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#)
				 AND CR_SIB.CATENTRY_ID_CHILD=CR_SIB_CHILD.CATENTRY_ID_PARENT AND CR_SIB_CHILD.CATENTRY_ID_CHILD=SIB_CHILD.CATENTRY_ID
				 AND SIB_CHILD.MARKFORDELETE=0 AND  SIB_CHILD.CATENTRY_ID NOT IN (SELECT CATENTRY_ID FROM TI_D_CATENTRY_#INDEX_SCOPE_TAG#))"/>
		<_config:mapping>
		  <_config:key queryColumn="CATENTRY_ID" tableColumn="CATENTRY_ID"/>
		  <_config:column-mapping>
			<_config:column-column-mapping>
				<_config:column-column queryColumn="CATENTTYPE_ID" tableColumn="CATENTTYPE_ID" />
			</_config:column-column-mapping>
			</_config:column-mapping>
		</_config:mapping>
	</_config:data-processing-config>
  
	<_config:data-processing-config processor="com.ibm.commerce.foundation.dataimport.preprocess.StaticAttributeDataPreProcessor" batchSize="500" >
		<_config:table definition="CREATE TABLE TI_X_CATENTRY_#INDEX_SCOPE_TAG# (CATENTRY_ID BIGINT NOT NULL, ACTION CHAR(1), PRIMARY KEY (CATENTRY_ID))" name="TI_X_CATENTRY_#INDEX_SCOPE_TAG#"/>
		<_config:query sql="SELECT CATENTRY_ID, ACTION FROM TI_DELTA_CATENTRY CE WHERE CE.ACTION='X' AND CE.MASTERCATALOG_ID=#MASTER_CATALOG_ID#"/>
		<_config:mapping>
		  <_config:key queryColumn="CATENTRY_ID" tableColumn="CATENTRY_ID"/>
		  <_config:column-mapping>
			<_config:column-column-mapping>
				<_config:column-column queryColumn="ACTION" tableColumn="ACTION" />
			</_config:column-column-mapping>
			</_config:column-mapping>
		</_config:mapping>
	</_config:data-processing-config>
</_config:DIHPreProcessConfig>
