<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of IBM

  WebSphere Commerce

  (C) Copyright IBM Corp. 2016 All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or
  disclosure restricted by GSA ADP Schedule Contract with
  IBM Corp.
 =================================================================
-->  
<_config:DIHPreProcessConfig xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../xsd/wc-dataimport-preprocess.xsd ">	

 <_config:data-processing-config processor="com.ibm.commerce.foundation.dataimport.preprocess.FinalViewDataPreProcessor"  fetchSize="500" batchSize="500">
   <_config:table definition="CREATE OR REPLACE VIEW VI_CG_#INDEX_SCOPE_TAG#_#lang_tag# AS(
								SELECT	
									CATGROUP.CATGROUP_ID, CATGROUP.MEMBER_ID, CATGROUP.IDENTIFIER,
									STORECGRP.STOREENT_ID,
									CATGRPDESC.NAME, CATGRPDESC.SHORTDESCRIPTION, CATGRPDESC.LONGDESCRIPTION, COALESCE(TE.PATH,CATGRPDESC.THUMBNAIL) AS THUMBNAIL,COALESCE(FE.PATH, CATGRPDESC.FULLIMAGE) AS FULLIMAGE, CATGRPDESC.KEYWORD, CATGRPDESC.PUBLISHED,
									TI_CGPUB.PUBLISHED DEEPPUBLISHED,								
									TI_CGCATALOG.CATALOG PARENT_CATALOG_ID,
									TI_CGSEOURL.SEO_TOKEN,
									TI_GDPGROUP_#INDEX_SCOPE_TAG#_#lang_tag#.CATGROUP PARENT_CATGROUP_ID,
									TI_CATGRPREL_#INDEX_SCOPE_TAG#_#lang_tag#.SEQUENCE CATGROUP_SEQUENCE,
									TI_DCCATGRP.DCCATGRP CHILD_CATGROUP_ID,
									TI_CATGRP.CATALOGGROUP						
								FROM CATGROUP
									INNER JOIN TI_CGCATALOG_#INDEX_SCOPE_TAG#_#lang_tag# CG ON (CATGROUP.CATGROUP_ID=CG.CATGROUP_ID)
									LEFT OUTER JOIN TI_CGCATALOG_#INDEX_SCOPE_TAG#_#lang_tag# TI_CGCATALOG ON (CATGROUP.CATGROUP_ID=TI_CGCATALOG.CATGROUP_ID)
									LEFT OUTER JOIN STORECGRP ON (CATGROUP.CATGROUP_ID=STORECGRP.CATGROUP_ID)
									LEFT OUTER JOIN CATGRPDESC ON (CATGRPDESC.CATGROUP_ID=CATGROUP.CATGROUP_ID AND CATGRPDESC.LANGUAGE_ID=?language_id?)
									LEFT OUTER JOIN (SELECT CATGROUP_ID, LANGUAGE_ID, PATH FROM CATGROUP_EXTERNAL_CONTENT_REL TR, EXTERNAL_CONTENT_ASSET TA, EXTERNAL_CONTENT_TYPE TT WHERE TR.CONTENT_ID = TA.CONTENT_ID AND TR.TYPE = TT.IDENTIFIER AND TT.USAGE = 'images' AND TA.ASSETNAME = 'main_thumbnail') TE ON TE.CATGROUP_ID=CATGROUP.CATGROUP_ID AND TE.LANGUAGE_ID=?language_id?
									LEFT OUTER JOIN (SELECT CATGROUP_ID, LANGUAGE_ID, PATH FROM CATGROUP_EXTERNAL_CONTENT_REL FR, EXTERNAL_CONTENT_ASSET FA, EXTERNAL_CONTENT_TYPE FT WHERE FR.CONTENT_ID = FA.CONTENT_ID AND FR.TYPE = FT.IDENTIFIER AND FT.USAGE = 'images' AND FA.ASSETNAME = 'main_fullimage') FE ON FE.CATGROUP_ID=CATGROUP.CATGROUP_ID AND FE.LANGUAGE_ID=?language_id?
									LEFT OUTER JOIN TI_GCGPUB_#INDEX_SCOPE_TAG# TI_CGPUB ON (CATGROUP.CATGROUP_ID=TI_CGPUB.CATGROUP_ID)
									LEFT OUTER JOIN TI_CGSEOURL_#INDEX_SCOPE_TAG#_#lang_tag# TI_CGSEOURL ON (CATGROUP.CATGROUP_ID=TI_CGSEOURL.CATGROUP_ID)
									LEFT OUTER JOIN TI_GDPGROUP_#INDEX_SCOPE_TAG#_#lang_tag# ON (CATGROUP.CATGROUP_ID=TI_GDPGROUP_#INDEX_SCOPE_TAG#_#lang_tag#.CATGROUP_ID)
									LEFT OUTER JOIN TI_CATGRPREL_#INDEX_SCOPE_TAG#_#lang_tag# ON (CATGROUP.CATGROUP_ID=TI_CATGRPREL_#INDEX_SCOPE_TAG#_#lang_tag#.CATGROUP_ID)
									LEFT OUTER JOIN TI_DCCATGRP_#INDEX_SCOPE_TAG#_#lang_tag# TI_DCCATGRP ON (CATGROUP.CATGROUP_ID=TI_DCCATGRP.CATGROUP_ID)
									LEFT OUTER JOIN TI_CATGRP_#INDEX_SCOPE_TAG#_#lang_tag# TI_CATGRP ON (CATGROUP.CATGROUP_ID=TI_CATGRP.CATGROUP_ID)
								WHERE
									CATGROUP.MARKFORDELETE=0)" name="VI_CG_#INDEX_SCOPE_TAG#_#lang_tag#"/>
		
	<_config:query sql="SELECT 1 CATGROUP_ID FROM CATGROUP WHERE 1=-1"/>
	
    <_config:mapping>
      <_config:key queryColumn="CATGROUP_ID" tableColumn="CATGROUP_ID"/>
    </_config:mapping>
  </_config:data-processing-config>
   
</_config:DIHPreProcessConfig>
